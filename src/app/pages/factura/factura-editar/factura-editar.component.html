<c-card class="my-4" *ngIf="!loaderFacturas">
  <c-tabs [activeItemKey]="'profile'" (activeItemKeyChange)="tabChange($event)">
    <c-tabs-list variant="tabs">
      <button cTab itemKey="Empleado">
        {{ Factura.empleado?.nombre_completo }}
      </button>
    </c-tabs-list>
    <c-tabs-content>
      <c-tab-panel class="p-3" itemKey="Empleado">
        <c-card-header>
          <div
            class="w-100 d-flex justify-content-between align-items-center flex-wrap mb-3"
          >
            <p class="h3">
              Facturaci√≥n {{ Factura.empleado?.nombre_completo }}
            </p>
            <h4>
              Facturado :
              {{
                _FacturaPedidoService.sumarTotalesPorEmpleado(
                  Factura.empleado_id
                ) | currency : "ARS"
              }}
            </h4>
          </div>
        </c-card-header>
        <c-card-body class="pt-4">
          <c-container [fluid]="true" class="px-0">
            <c-accordion [alwaysOpen]="true">
              <ng-container
                *ngFor="
                  let facturaDetail of Factura.factura_detalle;
                  let j = index
                "
              >
                <c-accordion-item #item="cAccordionItem" [visible]="false">
                  <ng-template cTemplateId="accordionHeaderTemplate">
                    <button
                      (click)="item.toggleItem()"
                      [collapsed]="!item.visible"
                      cAccordionButton
                      class="w-100 text-start"
                      [class.hasPago]="
                        validarEstadoPago(j, numberValue(Factura.empleado_id))
                      "
                      [class.notHasPago]="
                        !validarEstadoPago(j, numberValue(Factura.empleado_id))
                      "
                    >
                      <div
                        class="d-flex justify-content-between align-items-center w-100"
                      >
                        <div class="d-flex align-items-center">
                          <p class="h5 text-info mb-0">
                            {{ j + 1 }} - {{ facturaDetail.cliente?.nombre }}
                            {{ facturaDetail.cliente?.apellido }}
                          </p>
                          <span
                            class="ms-3 pointer"
                            (click)="
                              eliminarFacturaDetalle(
                                facturaDetail,
                                numberValue(Factura.empleado_id)
                              );
                              $event.stopPropagation()
                            "
                          >
                            <svg
                              cIcon
                              height="18"
                              class="text-danger"
                              name="cil-trash"
                            ></svg>
                          </span>
                        </div>
                        <span class="me-3 text-muted">
                          <strong>Fecha:</strong>
                          {{ Factura.created_at | date : "dd/MM/yyyy HH:mm" }}
                        </span>
                      </div>
                    </button>
                  </ng-template>
                  <ng-template cTemplateId="accordionBodyTemplate">
                    <div
                      class="small text-body-secondary mt-2 border p-4"
                      [class.hasPago]="
                        validarEstadoPago(j, numberValue(Factura.empleado_id))
                      "
                      [class.notHasPago]="
                        !validarEstadoPago(j, numberValue(Factura.empleado_id))
                      "
                    >
                      <app-pedido-new-form
                        (FormsValues)="FormsValues($event)"
                        [Clientes]="Clientes"
                        [MetodosPagos]="MetodosPagos"
                        [Productos]="Productos"
                        [Servicios]="Servicios"
                        [PedidoDetail]="facturaDetail"
                        (ActualizarProductos)="ActualizarProductos($event)"
                        [EmpleadoId]="numberValue(Factura.empleado_id)"
                        (TienePago)="actualizarEstadoPago($event, j)"
                      ></app-pedido-new-form>
                    </div>
                  </ng-template>
                </c-accordion-item>
              </ng-container>
            </c-accordion>
          </c-container>
        </c-card-body>
      </c-tab-panel>
    </c-tabs-content>
  </c-tabs>
</c-card>
<c-card *ngIf="loaderFacturas">
  <c-card-body>
    <c-container [fluid]="true" class="my-table-full px-0 text-center">
      <c-row class="mb-4">
        <c-col>
          <div class="small text-body-secondary mt-3">
            <span class="h4"> Cargando <c-spinner size="sm" /></span>
          </div>
        </c-col>
      </c-row>
    </c-container>
  </c-card-body>
</c-card>
